<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•í™”í•˜ê¸° v1.0</title>
    <style>
        :root { --bg: #1a1a2e; --panel: #16213e; --point: #e94560; --text: #ecf0f1; --money: #f1c40f; --mine: #2ecc71; --hunt: #3498db; --hp: #ff4d4d; }
        body { font-family: 'Malgun Gothic', sans-serif; text-align: center; background-color: var(--bg); color: var(--text); padding: 5px; margin: 0; }
        #game-container { background: var(--panel); max-width: 650px; margin: 0 auto; padding: 20px; border-radius: 15px; border: 2px solid var(--point); min-height: 95vh; box-sizing: border-box; position: relative; }
        .page { display: none; } .page.active { display: block; }
        
        /* ìƒë‹¨ ë°” */
        .stat-header { background: #0f3460; padding: 12px; border-radius: 12px; margin-bottom: 15px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; border-bottom: 3px solid var(--point); font-size: 0.85em; }
        .hp-bar-container { grid-column: span 2; background: #333; height: 12px; border-radius: 6px; overflow: hidden; margin-top: 5px; border: 1px solid #000; }
        #hp-fill { background: var(--hp); height: 100%; width: 100%; transition: 0.3s; }
        
        .main-layout { display: grid; grid-template-columns: 1.2fr 1fr; gap: 10px; margin-bottom: 10px; }
        .panel-box { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; font-size: 0.85em; text-align: left; }
        
        /* ì„ íƒ ê°•í™” íƒ­ */
        .tab-container { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab { flex: 1; padding: 10px; background: #0f3460; cursor: pointer; border-radius: 8px; font-size: 0.9em; border: 1px solid transparent; }
        .tab.active { background: var(--point); border-color: white; }

        .game-grid { display: grid; grid-template-columns: repeat(4, 75px); gap: 10px; justify-content: center; margin: 15px auto; }
        /* ì‚¬ëƒ¥í„° 5ì¹¸ ì „ìš© */
        .hunt-grid-5 { display: flex; justify-content: center; gap: 8px; margin: 15px auto; flex-wrap: wrap; }
        .cell { width: 75px; height: 75px; background: #0f3460; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.6em; position: relative; border: 2px solid #1a1a2e; transition: 0.1s; }
        .cell:active { transform: scale(0.95); }
        .monster-lv { position: absolute; bottom: 3px; right: 3px; font-size: 0.7em; font-weight: bold; background: rgba(0,0,0,0.85); padding: 2px 5px; border-radius: 4px; }
        
        button { padding: 12px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; margin: 3px 0; width: 100%; }
        .btn-upgrade { background: var(--point); color: white; height: 60px; font-size: 1.2em; box-shadow: 0 4px #a02d41; }
        .btn-nav { background: #533483; color: white; }
        #log, #hunt-log { height: 100px; overflow-y: auto; background: #1a1a2e; border-radius: 8px; padding: 10px; margin: 10px 0; font-size: 0.85em; text-align: left; color: #95a5a6; }
        
        /* íŒì—… ìŠ¤í™ì°½ */
        .modal { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #16213e; border: 3px solid var(--money); padding: 20px; border-radius: 15px; width: 80%; z-index: 100; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .spec-item { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); }

        .item-icon { width: 40px; height: 40px; margin-right: 12px; border-radius: 6px; object-fit: cover; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="stat-header">
        <div>ğŸ’° <span id="gold">0</span>G</div>
        <div>ğŸ§© ì¡°ê° <span id="shards">0</span></div>
        <div class="hp-bar-container"><div id="hp-fill"></div></div>
        <div style="grid-column: span 2; font-size: 0.9em; display:flex; justify-content: space-between;">
            <span>â¤ï¸ HP: <span id="hp-text">100</span> / 100</span>
            <span onclick="showModal()" style="color:var(--money); cursor:pointer;">[ğŸ‘¤ ë‚´ ì •ë³´ ë³´ê¸°]</span>
        </div>
    </div>

    <div id="page-main" class="page active">
        <div class="tab-container">
            <div class="tab active" id="tab-sword" onclick="setTarget('sword')">âš”ï¸ ê²€ ê°•í™”</div>
            <div class="tab" id="tab-cloth" onclick="setTarget('cloth')">ğŸ‘• ì²œ ì˜· ê°•í™”</div>
        </div>

        <div class="main-layout">
            <div class="panel-box">
                <h4 style="margin:0 0 8px 0; color:var(--money);">ğŸ›¡ï¸ ë°©ì§€ê¶Œ ì„ íƒ</h4>
                <label style="display:block; margin-bottom:5px;"><input type="radio" name="prot" value="0" id="prot-none" checked> ì‚¬ìš© ì•ˆ í•¨</label>
                <label style="display:block; margin-bottom:5px;"><input type="radio" name="prot" value="1"> <img src="image/scroll_1.png" style="width:18px;"> í•˜ê¸‰ (<span id="inv-1">0</span>)</label>
                <label style="display:block; margin-bottom:5px;"><input type="radio" name="prot" value="2"> <img src="image/scroll_2.png" style="width:18px;"> ì¤‘ê¸‰ (<span id="inv-2">0</span>)</label>
                <label style="display:block; margin-bottom:5px;"><input type="radio" name="prot" value="3"> <img src="image/scroll_3.png" style="width:18px;"> ìƒê¸‰ (<span id="inv-3">0</span>)</label>
            </div>
            <div class="panel-box" style="text-align:center;">
                <div style="font-size:1.1em; margin-bottom:10px;"><span id="target-name">ê²€</span> <span style="color:var(--money);">+<span id="target-lv">0</span></span></div>
                <div style="font-size:0.8em; color:#4ecca3;">ì„±ê³µ <span id="chance">0</span>%</div>
                <div style="font-size:0.8em; color:var(--point);">íŒŒê´´ <span id="break">0</span>%</div>
                <hr style="opacity:0.2;">
                <button style="background:var(--hunt); color:white; padding:5px; font-size:0.8em;" onclick="sellItem()">ì•„ì´í…œ íŒë§¤</button>
            </div>
        </div>

        <button class="btn-upgrade" onclick="tryUpgrade()">ê°•í™”í•˜ê¸° (<span id="cost">0</span>G)</button>
        <button class="btn-nav" style="background:#3498db;" id="auto-btn" onclick="startAutoUpgrade()">ìë™ ê°•í™” ë„ì „ (+10ê°•)</button>
        
        <div id="log">ì‹œìŠ¤í…œ: ê°•í™”í•˜ê¸° v1.0 ë¦¬ë¶€íŠ¸!</div>

        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px;">
            <button class="btn-nav" onclick="showPage('page-shop')">ğŸ’° ìƒì </button>
            <button class="btn-nav" style="background:var(--mine); color:black;" onclick="showPage('page-mine')">â›ï¸ ê´‘ì‚°</button>
            <button class="btn-nav" style="background:var(--hunt);" onclick="showPage('page-hunt')">âš”ï¸ ì‚¬ëƒ¥í„°</button>
        </div>
    </div>

    <div id="spec-modal" class="modal">
        <h3 style="color:var(--money); margin-top:0;">ğŸ‘¤ ìºë¦­í„° ìƒì„¸ ì •ë³´</h3>
        <div class="spec-item"><span>ì¥ì°© ë¬´ê¸°</span><span id="spec-sword-lv">+0</span></div>
        <div class="spec-item"><span>ì¥ì°© ë°©ì–´êµ¬</span><span id="spec-cloth-lv">+0</span></div>
        <div class="spec-item"><span style="color:#ff4d4d;">ê³µê²©ë ¥ (ATK)</span><span id="spec-atk">0</span></div>
        <div class="spec-item"><span style="color:#3498db;">ë°©ì–´ë ¥ (DEF)</span><span id="spec-def">0</span></div>
        <div class="spec-item"><span>ê³µê²© ì†ë„ (SPD)</span><span>1.0</span></div>
        <button onclick="closeModal()" style="background:#555; margin-top:15px;">ë‹«ê¸°</button>
    </div>

    <div id="page-hunt" class="page">
        <h2 style="color: var(--hunt);">âš”ï¸ ì „ëµ ì‚¬ëƒ¥í„°</h2>
        <div id="hunt-main">
            <p style="font-size:0.8em;">ë¬´ê¸° ë ˆë²¨ ê¸°ì¤€ 5ë§ˆë¦¬ì˜ ëª¬ìŠ¤í„°ê°€ íƒìƒ‰ë©ë‹ˆë‹¤.</p>
            <button id="hunt-scan-btn" onclick="scanHunt()" style="background: var(--hunt); color: white;">ğŸ“¡ ëª¬ìŠ¤í„° íƒìƒ‰ (5,000G)</button>
            <div class="hunt-grid-5" id="hunt-grid"></div>
            <div id="hunt-log">ì „íˆ¬ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”.</div>
            <button class="btn-nav" onclick="showPage('page-main')">â¬…ï¸ ë©”ì¸ìœ¼ë¡œ</button>
        </div>
        <div id="battle-screen" style="display:none;">
            <div style="background:rgba(0,0,0,0.5); padding:20px; border-radius:10px;">
                <div id="battle-msg" style="font-size:1.2em; margin-bottom:15px; color:var(--money);">ì „íˆ¬ ì¤‘...</div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>ë‚˜<br><span id="player-battle-hp" style="color:var(--hp);">100</span></div>
                    <div style="font-size:2em;">VS</div>
                    <div>ëª¬ìŠ¤í„°<br><span id="monster-battle-hp" style="color:var(--hp);">100</span></div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-shop" class="page">
        <h2 style="color: var(--money);">ğŸ’° ìƒì </h2>
        <div style="text-align:left; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:10px;">
            <img src="image/scroll_1.png" style="width:30px; vertical-align:middle;"> í•˜ê¸‰ ë°©ì§€ê¶Œ (10ë§ŒG) <button onclick="buyItem(1, 100000)" style="width:60px; float:right;">êµ¬ë§¤</button>
        </div>
        <div style="text-align:left; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:10px;">
            <img src="image/scroll_2.png" style="width:30px; vertical-align:middle;"> ì¤‘ê¸‰ ë°©ì§€ê¶Œ (50ë§ŒG) <button onclick="buyItem(2, 500000)" style="width:60px; float:right;">êµ¬ë§¤</button>
        </div>
        <div style="text-align:left; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:10px;">
            <img src="image/scroll_3.png" style="width:30px; vertical-align:middle;"> ìƒê¸‰ ë°©ì§€ê¶Œ (200ë§ŒG) <button onclick="buyItem(3, 2000000)" style="width:60px; float:right;">êµ¬ë§¤</button>
        </div>
        <button class="btn-nav" onclick="showPage('page-main')">â¬…ï¸ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="page-mine" class="page">
        <h2 style="color: var(--mine);">â›ï¸ ê´‘ì‚°</h2>
        <div id="mine-grid" class="game-grid"></div>
        <button id="mine-scan-btn" onclick="scanMine()" style="background:var(--mine); color:black;">ê´‘ì„ íƒìƒ‰ (1,000G)</button>
        <button class="btn-nav" onclick="showPage('page-main')">ëŒì•„ê°€ê¸°</button>
    </div>
</div>

<script>
    // [ë°ì´í„° êµ¬ì¡°] ê²€ê³¼ ì²œ ì˜· ë ˆë²¨ ë¶„ë¦¬
    let data = { 
        swordLv: 0, 
        clothLv: 0, 
        hp: 100, 
        gold: 100000, 
        shards: 0, 
        inv: { item1: 0, item2: 0, item3: 0 },
        target: 'sword' // í˜„ì¬ ì„ íƒëœ ê°•í™” ëŒ€ìƒ
    };
    
    let isAuto = false;
    let huntData = [];
    let mineData = [];

    // [í…Œì´ë¸”] ê³µê²©ë ¥ ë° ë°©ì–´ë ¥ ê³„ì‚° ê³µì‹
    function getAtk(lv) { return Math.floor(10 + (lv * 5) + Math.pow(lv, 2.5)); }
    function getDef(lv) { return Math.floor(2 + (lv * 2) + Math.pow(lv, 2.2)); }
    
    function getUpgradeData(lv) {
        const cost = Math.floor(10 * Math.pow(2.1, lv));
        const sc = lv < 3 ? 100 : lv < 6 ? 85 : lv < 9 ? 60 : lv === 9 ? 50 : 40;
        const bc = lv >= 10 ? Math.min(50, 5 + (lv - 10) * 5) : 0;
        return { sc, bc, cost };
    }

    function updateUI() {
        const lv = data.target === 'sword' ? data.swordLv : data.clothLv;
        const ud = getUpgradeData(lv);
        
        document.getElementById('target-name').innerText = data.target === 'sword' ? 'ê²€' : 'ì²œ ì˜·';
        document.getElementById('target-lv').innerText = lv;
        document.getElementById('gold').innerText = data.gold.toLocaleString();
        document.getElementById('shards').innerText = data.shards;
        document.getElementById('hp-text').innerText = Math.floor(data.hp);
        document.getElementById('hp-fill').style.width = data.hp + '%';
        
        document.getElementById('chance').innerText = ud.sc;
        document.getElementById('break').innerText = ud.bc;
        document.getElementById('cost').innerText = ud.cost.toLocaleString();
        
        document.getElementById('inv-1').innerText = data.inv.item1;
        document.getElementById('inv-2').innerText = data.inv.item2;
        document.getElementById('inv-3').innerText = data.inv.item3;

        document.getElementById('auto-btn').innerText = isAuto ? "ì¤‘ë‹¨í•˜ê¸°" : "ìë™ ê°•í™” ë„ì „ (+10ê°•)";
    }

    function setTarget(t) {
        data.target = t;
        document.getElementById('tab-sword').classList.toggle('active', t === 'sword');
        document.getElementById('tab-cloth').classList.toggle('active', t === 'cloth');
        updateUI();
    }

    // [ê°•í™” ë¡œì§] 0.1ì´ˆ ì†ë„ ë°˜ì˜
    function tryUpgrade() {
        const lvKey = data.target === 'sword' ? 'swordLv' : 'clothLv';
        const ud = getUpgradeData(data[lvKey]);
        if(data.gold < ud.cost) { isAuto = false; addLog("ê³¨ë“œ ë¶€ì¡±!"); return; }

        const sel = document.querySelector('input[name="prot"]:checked').value;
        if (sel !== "0") {
            if (data.inv[`item${sel}`] > 0) data.inv[`item${sel}`]--;
            else { addLog("ë°©ì§€ê¶Œ ë¶€ì¡±!"); isAuto = false; return; }
        }

        data.gold -= ud.cost;
        if(Math.random()*100 < ud.sc) {
            data[lvKey]++; addLog(`+${data[lvKey]} ${data.target === 'sword' ? 'ê²€':'ì²œì˜·'} ì„±ê³µ!`, "#4ecca3");
        } else {
            if(Math.random()*100 < ud.bc && sel !== "3") {
                data[lvKey] = 0; data.shards++; addLog("íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤!", "red"); isAuto = false;
            } else {
                data[lvKey] = Math.max(0, data[lvKey]-1); addLog("ì‹¤íŒ¨(ë‹¨ê³„ í•˜ë½)");
            }
        }
        save();
    }

    function startAutoUpgrade() {
        if(isAuto) { isAuto=false; return; }
        isAuto = true;
        const itv = setInterval(() => {
            const lvKey = data.target === 'sword' ? 'swordLv' : 'clothLv';
            if(!isAuto || data[lvKey] >= 10) { clearInterval(itv); isAuto=false; updateUI(); return; }
            tryUpgrade();
        }, 100);
    }

    // [ì‚¬ëƒ¥í„°] 5ì¹¸ í„´ì œ ì „íˆ¬ ë¡œì§
    function scanHunt() {
        if(data.gold < 5000) { alert("ê³¨ë“œ ë¶€ì¡±!"); return; }
        data.gold -= 5000;
        const diffs = [-2, -1, 0, 1, 2];
        const icons = ["ğŸ­", "ğŸ", "ğŸº", "ğŸ—", "ğŸ‘¹"];
        huntData = diffs.map((d, i) => ({
            icon: icons[i],
            lv: Math.max(0, data.swordLv + d),
            diff: d
        }));
        renderHunt();
        save();
    }

    function renderHunt() {
        const g = document.getElementById('hunt-grid'); g.innerHTML = "";
        huntData.forEach((m, i) => {
            const c = document.createElement('div'); c.className = "cell";
            let color = m.diff > 0 ? "var(--point)" : m.diff < 0 ? "#2ecc71" : "var(--money)";
            c.innerHTML = `${m.icon} <span class="monster-lv" style="color:${color}">Lv.${m.lv}</span>`;
            c.onclick = () => startBattle(m);
            g.appendChild(c);
        });
    }

    function startBattle(m) {
        if(data.hp <= 0) { alert("ì²´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤. íœ´ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤."); return; }
        document.getElementById('hunt-main').style.display = 'none';
        document.getElementById('battle-screen').style.display = 'block';
        
        let pAtk = getAtk(data.swordLv), pDef = getDef(data.clothLv), pHP = data.hp;
        let mAtk = getAtk(m.lv), mDef = getDef(m.lv) * 0.5, mHP = 50 + (m.lv * 20);
        
        document.getElementById('player-battle-hp').innerText = Math.floor(pHP);
        document.getElementById('monster-battle-hp').innerText = Math.floor(mHP);

        const bItv = setInterval(() => {
            // í”Œë ˆì´ì–´ í„´
            let pDmg = Math.max(1, pAtk - mDef);
            mHP -= pDmg;
            document.getElementById('battle-msg').innerText = `ëª¬ìŠ¤í„°ì—ê²Œ ${pDmg} ë°ë¯¸ì§€!`;
            
            if(mHP <= 0) {
                clearInterval(bItv);
                winBattle(m);
                return;
            }

            // ëª¬ìŠ¤í„° í„´
            setTimeout(() => {
                let mDmg = Math.max(1, mAtk - pDef);
                data.hp -= mDmg;
                document.getElementById('battle-msg').innerText = `ëª¬ìŠ¤í„°ì˜ ë°˜ê²©! ${mDmg} ë°ë¯¸ì§€!`;
                document.getElementById('player-battle-hp').innerText = Math.max(0, Math.floor(data.hp));
                document.getElementById('monster-battle-hp').innerText = Math.max(0, Math.floor(mHP));
                
                if(data.hp <= 0) {
                    clearInterval(bItv);
                    data.hp = 0;
                    alert("ì „íˆ¬ íŒ¨ë°°... ë§ˆì„ë¡œ ê·€í™˜í•©ë‹ˆë‹¤.");
                    location.reload();
                }
            }, 300);
        }, 800);
    }

    function winBattle(m) {
        const reward = Math.floor(Math.pow(2, m.lv) * 50);
        data.gold += reward;
        alert(`ì „íˆ¬ ìŠ¹ë¦¬! ${reward.toLocaleString()}G íšë“!`);
        document.getElementById('hunt-main').style.display = 'block';
        document.getElementById('battle-screen').style.display = 'none';
        huntData = []; renderHunt(); save();
    }

    // [ê´‘ì‚°] ìƒëµ (ê¸°ì¡´ ìœ ì§€)
    function scanMine() { 
        if(data.gold < 1000) return; data.gold -= 1000; 
        mineData = Array.from({length:16}, () => Math.random() > 0.7 ? {e:"ğŸ’", p:5000} : {e:"ğŸª¨", p:500});
        renderMine(); save();
    }
    function renderMine() {
        const g = document.getElementById('mine-grid'); g.innerHTML = "";
        mineData.forEach((ore, i) => {
            const c = document.createElement('div'); c.className = "cell";
            if(ore) { c.innerText = ore.e; c.onclick = () => { data.gold += ore.p; mineData[i] = null; renderMine(); save(); }; }
            g.appendChild(c);
        });
    }

    // ëª¨ë‹¬ ê´€ë¦¬
    function showModal() {
        document.getElementById('spec-sword-lv').innerText = `+${data.swordLv}`;
        document.getElementById('spec-cloth-lv').innerText = `+${data.clothLv}`;
        document.getElementById('spec-atk').innerText = getAtk(data.swordLv);
        document.getElementById('spec-def').innerText = getDef(data.clothLv);
        document.getElementById('spec-modal').style.display = 'block';
    }
    function closeModal() { document.getElementById('spec-modal').style.display = 'none'; }

    function showPage(p) { document.querySelectorAll('.page').forEach(el => el.classList.remove('active')); document.getElementById(p).classList.add('active'); }
    function addLog(m, c) { const l = document.getElementById('log'); l.innerHTML = `<div style="color:${c || '#95a5a6'}">> ${m}</div>` + l.innerHTML; }
    function buyItem(t, p) { if(data.gold >= p) { data.gold -= p; data.inv[`item${t}`]++; save(); } }

    const SAVE_KEY = 'swordRPG_fixed';
    function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(data)); updateUI(); }
    function load() { const s = localStorage.getItem(SAVE_KEY); if(s) data = JSON.parse(s); updateUI(); }

    // ìë™ íšŒë³µ (ë©”ì¸ í™”ë©´ì—ì„œ 3ì´ˆë‹¹ 1ì”©)
    setInterval(() => { if(data.hp < 100) { data.hp = Math.min(100, data.hp + 1); updateUI(); } }, 3000);

    load();
</script>
</body>
</html>
