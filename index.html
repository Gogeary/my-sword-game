<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•í™”í•˜ê¸° vx.x - ê°•í™” ì œí•œ ì—…ë°ì´íŠ¸</title>
    <style>
        :root {
            --money: #f1c40f;
            --hunt: #e67e22;
            --mine: #95a5a6;
            --point: #e74c3c;
            --bg: #2c3e50;
        }
        body { background: var(--bg); color: white; font-family: 'Malgun Gothic', sans-serif; text-align: center; margin: 0; }
        #game-container { max-width: 500px; margin: 0 auto; padding: 10px; }
        
        /* ìƒë‹¨ ë°” */
        .top-bar { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; margin-bottom: 15px; }
        .bar-outer { width: 100%; height: 18px; background: #444; margin: 5px 0; position: relative; border-radius: 9px; overflow: hidden; border: 1px solid #555; }
        #hp-fill { height: 100%; background: #e74c3c; width: 100%; transition: 0.3s; }
        .bar-text { position: absolute; width: 100%; top: 0; left: 0; font-size: 11px; line-height: 18px; color: white; text-shadow: 1px 1px 1px #000; }

        .page { display: none; padding: 10px; }
        .active { display: block; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .main-menu-btn, .btn-nav, .btn-upgrade { 
            display: block; width: 90%; margin: 10px auto; padding: 12px; 
            border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; font-size: 1rem;
        }
        .main-menu-btn { background: #34495e; box-shadow: 0 4px #222; }
        .btn-nav { background: #7f8c8d; }
        .btn-upgrade { background: #27ae60; width: 100%; height: 50px; transition: 0.2s; }
        .btn-upgrade:disabled { background: #555; cursor: not-allowed; }

        /* ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ */
        .inv-item { 
            display: flex; align-items: center; background: rgba(255,255,255,0.1); 
            margin-bottom: 8px; padding: 8px; border-radius: 8px; border: 1px solid #444;
        }
        .item-img { width: 45px; height: 45px; background: #1a1a1a; border-radius: 5px; margin-right: 12px; object-fit: contain; }
        .item-info { flex-grow: 1; text-align: left; }
        .item-name { font-weight: bold; font-size: 0.9em; }
        .sell-btn { background: #c0392b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; }
        .modal-content { background: #34495e; width: 85%; max-width: 400px; margin: 15% auto; padding: 20px; border-radius: 12px; max-height: 70vh; overflow-y: auto; }

        #upgrade-target-display { 
            background: #1a1a1a; padding: 20px; border-radius: 10px; border: 2px dashed #555; margin-bottom: 15px;
            display: flex; flex-direction: column; align-items: center; min-height: 120px;
        }
        .target-img-large { width: 80px; height: 80px; margin-bottom: 10px; object-fit: contain; }
        #log-container { font-size: 0.85em; color: #4ecca3; margin-top: 10px; min-height: 1.2em; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="top-bar">
        <div style="display:flex; justify-content: space-between; margin-bottom:5px;">
            <div>ğŸ’° <span id="gold">10,000</span>G</div>
            <div>ğŸ§ª <span id="potion-total">0</span></div>
        </div>
        <div class="bar-outer">
            <div id="hp-fill"></div>
            <div class="bar-text">â¤ï¸ HP <span id="hp-val">100</span> / 100</div>
        </div>
    </div>

    <div id="page-main" class="page active">
        <h1 style="color:var(--money);">ê°•í™”í•˜ê¸° vx.x</h1>
        <div class="main-menu-btn" onclick="showPage('page-upgrade')">ğŸ”¨ ê°•í™”í•˜ê¸°</div>
        <div class="main-menu-btn" onclick="showPage('page-info')">ğŸ‘¤ ë‚´ ì •ë³´ (ì¸ë²¤í† ë¦¬)</div>
    </div>

    <div id="page-info" class="page">
        <h2>ğŸ‘¤ ë‚´ ì •ë³´ & ì¸ë²¤í† ë¦¬</h2>
        <div id="inventory-list"></div>
        <button class="btn-nav" onclick="showPage('page-main')">â¬…ï¸ ë’¤ë¡œê°€ê¸°</button>
    </div>

    <div id="page-upgrade" class="page">
        <h2>ğŸ”¨ ì¥ë¹„ ê°•í™” (ìµœëŒ€ +10)</h2>
        <div id="upgrade-target-display">
            <p id="target-text">ê°•í™”í•  ì¥ë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        </div>
        <button class="main-menu-btn" style="background:var(--hunt);" onclick="openInventoryModal()">ğŸ“¦ ê°•í™”í•  ì¥ë¹„ ì„ íƒ</button>
        
        <div style="font-size:0.85em; margin: 15px 0; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px;">
            <span style="color:#4ecca3;">ì„±ê³µë¥ : <span id="success-rate">-</span>%</span> | 
            <span style="color:var(--point);">íŒŒê´´í™•ë¥ : <span id="break-rate">-</span>%</span>
        </div>

        <button class="btn-upgrade" id="btn-up-exec" onclick="tryUpgrade()" disabled>ê°•í™”í•˜ê¸°</button>
        <div id="log-container"></div>
        <button class="btn-nav" onclick="showPage('page-main')">â¬…ï¸ ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <div id="inv-modal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--money); margin-top:0;">ğŸ“¦ ê°•í™”í•  ì¥ë¹„ ì„ íƒ</h3>
            <div id="modal-item-list"></div>
            <button class="btn-nav" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    // --- ë¦¬ì†ŒìŠ¤ ë° ë°ì´í„° ---
    const IMAGES = {
        wood_sword: "image/wood_sword.png",
        loose_clothes: "image/loose_clothes.png",
        old_belt: "image/old_belt.png"
    };

    let player = {
        gold: 10000,
        inventory: [
            { id: 1, name: "ëª©ê²€", level: 0, price: 1000, img: IMAGES.wood_sword },
            { id: 2, name: "í—ë í•œ ì˜·", level: 9, price: 800, img: IMAGES.loose_clothes }
        ]
    };

    let selectedIdx = -1;
    const MAX_LEVEL = 10; // ê°•í™” ìµœëŒ€ ë ˆë²¨ ì œí•œ

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        if(pageId === 'page-info') renderInventory('inventory-list', true);
    }

    // --- ì¸ë²¤í† ë¦¬ ë Œë”ë§ ---
    function renderInventory(containerId, showSell) {
        const container = document.getElementById(containerId);
        container.innerHTML = player.inventory.length === 0 ? "<p>ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</p>" : "";

        player.inventory.forEach((item, idx) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'inv-item';
            const isMax = item.level >= MAX_LEVEL;

            itemDiv.innerHTML = `
                <img src="${item.img}" class="item-img" onerror="this.src='https://via.placeholder.com/45?text=No+Img'">
                <div class="item-info">
                    <div class="item-name">${item.name} <span style="color:${isMax?'#f1c40f':'#fff'}">(+${item.level})</span></div>
                    <div style="font-size:0.75em; color:#aaa;">íŒë§¤ê°€: ${Math.floor(item.price * 0.5)}G</div>
                </div>
                <div style="display:flex; gap:5px;">
                    ${containerId === 'modal-item-list' ? `<button onclick="selectItem(${idx})" style="background:#27ae60; color:white; border:none; padding:5px 10px; border-radius:4px;">ì„ íƒ</button>` : ''}
                    ${showSell ? `<button class="sell-btn" onclick="sellItem(${idx})">íŒë§¤</button>` : ''}
                </div>
            `;
            container.appendChild(itemDiv);
        });
    }

    function sellItem(idx) {
        const item = player.inventory[idx];
        const price = Math.floor(item.price * 0.5);
        if(confirm(`íŒë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            player.gold += price;
            player.inventory.splice(idx, 1);
            if(selectedIdx === idx) resetUpgradeUI();
            updateUI();
            renderInventory('inventory-list', true);
        }
    }

    // --- ê°•í™” ë¡œì§ ---
    function openInventoryModal() {
        document.getElementById('inv-modal').style.display = 'block';
        renderInventory('modal-item-list', false);
    }

    function closeModal() {
        document.getElementById('inv-modal').style.display = 'none';
    }

    function selectItem(idx) {
        selectedIdx = idx;
        const item = player.inventory[idx];
        const display = document.getElementById('upgrade-target-display');
        const btn = document.getElementById('btn-up-exec');

        display.innerHTML = `
            <img src="${item.img}" class="target-img-large">
            <div class="item-name" style="font-size:1.2em;">${item.name} (+${item.level})</div>
        `;

        if (item.level >= MAX_LEVEL) {
            btn.innerText = "ìµœëŒ€ ê°•í™” ë ˆë²¨ ë„ë‹¬";
            btn.disabled = true;
            document.getElementById('success-rate').innerText = "0";
        } else {
            const cost = (item.level + 1) * 500;
            btn.innerText = `ê°•í™”í•˜ê¸° (${cost}G)`;
            btn.disabled = false;
            document.getElementById('success-rate').innerText = 100 - (item.level * 10); // ì˜ˆì‹œ í™•ë¥ 
        }
        document.getElementById('break-rate').innerText = item.level > 5 ? (item.level - 5) * 5 : 0;
        closeModal();
    }

    function tryUpgrade() {
        if (selectedIdx === -1) return;
        let item = player.inventory[selectedIdx];
        
        // 1. ë ˆë²¨ ì²´í¬ (ë³´ì•ˆìš© ìƒì‹œ ì²´í¬)
        if (item.level >= MAX_LEVEL) {
            alert("ì´ë¯¸ ìµœëŒ€ ê°•í™” ë‹¨ê³„(+10)ì…ë‹ˆë‹¤.");
            return;
        }

        const cost = (item.level + 1) * 500;
        if (player.gold < cost) {
            alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            return;
        }

        // ê°•í™” ì‹œë®¬ë ˆì´ì…˜
        player.gold -= cost;
        const successRate = 100 - (item.level * 10);
        const rand = Math.random() * 100;

        if (rand < successRate) {
            item.level++;
            document.getElementById('log-container').innerText = "âœ¨ ê°•í™” ì„±ê³µ! (+" + item.level + ")";
            document.getElementById('log-container').style.color = "#4ecca3";
        } else {
            document.getElementById('log-container').innerText = "ğŸ’€ ê°•í™” ì‹¤íŒ¨...";
            document.getElementById('log-container').style.color = "#e74c3c";
        }

        updateUI();
        selectItem(selectedIdx); // UI ê°±ì‹  (ì—¬ê¸°ì„œ 10ê°• ë„ë‹¬ ì‹œ ë²„íŠ¼ ë¹„í™œì„±í™” ì²˜ë¦¬ë¨)
    }

    function resetUpgradeUI() {
        selectedIdx = -1;
        document.getElementById('upgrade-target-display').innerHTML = '<p>ê°•í™”í•  ì¥ë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>';
        document.getElementById('btn-up-exec').disabled = true;
        document.getElementById('btn-up-exec').innerText = "ê°•í™”í•˜ê¸°";
    }

    function updateUI() {
        document.getElementById('gold').innerText = player.gold.toLocaleString();
    }

    updateUI();
</script>
</body>
</html>
