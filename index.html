<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•í™”í•˜ê¸° v3.9</title>
    <style>
        :root { --bg: #1a1a2e; --panel: #16213e; --point: #e94560; --text: #ecf0f1; --money: #f1c40f; --mine: #2ecc71; --hunt: #3498db; }
        body { font-family: 'Malgun Gothic', sans-serif; text-align: center; background-color: var(--bg); color: var(--text); padding: 5px; margin: 0; }
        #game-container { background: var(--panel); max-width: 650px; margin: 0 auto; padding: 20px; border-radius: 15px; border: 2px solid var(--point); min-height: 95vh; box-sizing: border-box; }
        .page { display: none; } .page.active { display: block; }
        .stat-header { background: #0f3460; padding: 12px; border-radius: 12px; margin-bottom: 15px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; border-bottom: 3px solid var(--point); font-size: 0.85em; }
        .stat-value { font-weight: bold; color: var(--money); display: block; font-size: 1.1em; }
        .main-layout { display: grid; grid-template-columns: 1.2fr 1fr; gap: 10px; margin-bottom: 10px; }
        .panel-box { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; font-size: 0.8em; text-align: left; }
        
        /* [ìˆ˜ì •ë¨] ê²©ì ë””ìì¸ ê°œì„ : í•­ìƒ ì¤‘ì•™ ì •ë ¬ ë° 4ì—´ ê³ ì • */
        .grid-wrapper { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 10px; }
        .game-grid { display: grid; grid-template-columns: repeat(4, 70px); gap: 8px; justify-content: center; margin: 0 auto; }
        .cell { width: 70px; height: 70px; background: #0f3460; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.5em; position: relative; border: 2px solid #1a1a2e; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.1s; }
        .cell:active { transform: scale(0.95); }
        
        .monster-lv { position: absolute; bottom: 2px; right: 2px; font-size: 0.7em; font-weight: bold; background: rgba(0,0,0,0.8); padding: 2px 5px; border-radius: 4px; }
        button { padding: 12px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; margin: 3px 0; width: 100%; }
        .btn-upgrade { background: var(--point); color: white; height: 55px; font-size: 1.1em; box-shadow: 0 4px #a02d41; }
        .btn-nav { background: #533483; color: white; }
        #log, #hunt-log { height: 90px; overflow-y: auto; background: #1a1a2e; border-radius: 8px; padding: 8px; margin: 10px 0; font-size: 0.8em; text-align: left; color: #95a5a6; }
        .zone-btn { background: #0f3460; border: 2px solid var(--hunt); color: white; padding: 15px; font-size: 1em; margin-bottom: 10px; cursor: pointer; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80px; }
        .zone-btn:hover { background: var(--hunt); }
        .shop-row { display: flex; align-items: center; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 10px; margin-bottom: 8px; text-align: left; font-size: 0.9em; }
        .item-icon { width: 30px; height: 30px; margin-right: 10px; border-radius: 5px; }
        .radio-label { display: block; margin-bottom: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="stat-header">
        <div>í˜„ì¬ <span id="weapon-name" style="color:var(--hunt);">ê²€</span><span class="stat-value">+<span id="level">0</span></span></div>
        <div>ì¥ì°© ë¬´ê¸°<span class="stat-value" style="color:var(--mine);">+<span id="equipped-lv">N/A</span></span></div>
        <div>ë³´ìœ  ê³¨ë“œ<span class="stat-value"><span id="gold">0</span>G</span><div id="emergency-btn" onclick="getEmergencyMoney()" style="background:var(--point); color:white; font-size:0.8em; padding:2px; cursor:pointer; display:none; border-radius:4px; margin-top:4px;">ğŸ†˜ ê¸´ê¸‰ êµ¬ì œ</div></div>
        <div>ë³´ìœ  ì¡°ê°<span class="stat-value"><span id="shards">0</span>ê°œ</span></div>
    </div>

    <div id="page-main" class="page active">
        <div class="main-layout">
            <div class="panel-box">
                <h4 style="margin:0 0 8px 0; color:var(--money);">ğŸ›¡ï¸ ë°©ì§€ê¶Œ ì„ íƒ</h4>
                <label class="radio-label"><input type="radio" name="prot" value="0" id="prot-none" checked> ì‚¬ìš© ì•ˆ í•¨</label>
                <label class="radio-label"><input type="radio" name="prot" value="1"> í•˜ê¸‰ (~12ê°•) [<span id="inv-1">0</span>]</label>
                <label class="radio-label"><input type="radio" name="prot" value="2"> ì¤‘ê¸‰ (~15ê°•) [<span id="inv-2">0</span>]</label>
                <label class="radio-label"><input type="radio" name="prot" value="3"> ìƒê¸‰ (ë¬´ì œí•œ) [<span id="inv-3">0</span>]</label>
            </div>
            <div class="panel-box" style="display:flex; flex-direction:column; justify-content:center;">
                <div style="font-size:0.9em;">ì„±ê³µ <span id="chance" style="color:#4ecca3;">0</span>% / íŒŒê´´ <span id="break" style="color:var(--point);">0</span>%</div>
                <button style="background:var(--hunt); color:white; padding:5px; margin-top:5px;" onclick="equipWeapon()">ë¬´ê¸° ì¥ì°©</button>
                <button style="background:#4ecca3; color:black; padding:5px;" onclick="sellWeapon()">íŒë§¤ <span id="sell-p">0</span></button>
            </div>
        </div>
        <button class="btn-upgrade" onclick="tryUpgrade()">ê°• í™” ì‹œ ì‘ (<span id="cost">0</span>G)</button>
        <button class="btn-nav" style="background:#3498db;" id="auto-btn" onclick="startAutoUpgrade()">+10ê°• ìë™ ë„ì „</button>
        <div id="log">ì‹œìŠ¤í…œ: ì‚¬ëƒ¥í„° íƒìƒ‰ ë²„íŠ¼ì´ ì¶”ê°€ë˜ê³ , ê´‘ì‚° í™”ë©´ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px;">
            <button class="btn-nav" onclick="showPage('page-shop')">ğŸ’° ìƒì </button>
            <button class="btn-nav" style="background:var(--mine); color:black;" onclick="showPage('page-mine')">â›ï¸ ê´‘ì‚°</button>
            <button class="btn-nav" style="background:var(--hunt);" onclick="showPage('page-hunt')">âš”ï¸ ì‚¬ëƒ¥</button>
        </div>
    </div>

    <div id="page-shop" class="page">
        <h2 style="color: var(--money);">ğŸ’° ì•„ì´í…œ ìƒì </h2>
        <div class="shop-row">
            <img src="https://placehold.co/50x50/3498db/ffffff?text=ğŸ“œ" class="item-icon">
            <div style="flex:1;">í•˜ê¸‰ ë°©ì§€ê¶Œ (10ë§ŒG)<br><small>ìµœëŒ€ 12ê°•ê¹Œì§€ ë³´í˜¸</small></div>
            <button style="width:70px; background:var(--money); color:black;" onclick="buyItem(1, 100000)">êµ¬ë§¤</button>
        </div>
        <div class="shop-row">
            <img src="https://placehold.co/50x50/9b59b6/ffffff?text=ğŸ“œ" class="item-icon">
            <div style="flex:1;">ì¤‘ê¸‰ ë°©ì§€ê¶Œ (50ë§ŒG)<br><small>ìµœëŒ€ 15ê°•ê¹Œì§€ ë³´í˜¸</small></div>
            <button style="width:70px; background:var(--money); color:black;" onclick="buyItem(2, 500000)">êµ¬ë§¤</button>
        </div>
        <div class="shop-row">
            <img src="https://placehold.co/50x50/f1c40f/000000?text=ğŸ“œ" class="item-icon">
            <div style="flex:1;">ìƒê¸‰ ë°©ì§€ê¶Œ (200ë§ŒG)<br><small>ëª¨ë“  êµ¬ê°„ ë³´í˜¸ ê°€ëŠ¥</small></div>
            <button style="width:70px; background:var(--money); color:black;" onclick="buyItem(3, 2000000)">êµ¬ë§¤</button>
        </div>
        <div class="shop-row">
            <img src="https://placehold.co/50x50/e74c3c/ffffff?text=ğŸ§©" class="item-icon">
            <div style="flex:1;">ì¡°ê° í™˜ì „<br><small>+50,000G ì§€ê¸‰</small></div>
            <button style="width:70px; background:#533483; color:white;" onclick="exchangeShards()">í™˜ì „</button>
        </div>
        <button class="btn-nav" onclick="showPage('page-main')">â¬…ï¸ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="page-hunt" class="page">
        <h2 style="color: var(--hunt);">âš”ï¸ ì‚¬ëƒ¥í„° êµ¬ì—­ ì„ íƒ</h2>
        <div id="hunt-zone-select">
            <div class="zone-btn" onclick="enterZone(1)">
                <strong>[ì´ˆë³´ ì‚¬ëƒ¥í„°] Lv.1 ~ 10</strong>
                <small style="margin-top:5px; display:block;">ì…ì¥ë£Œ: 5,000G<br>ìˆ˜ìµ: ëª¬ìŠ¤í„° ë ˆë²¨ ê¸°ì¤€</small>
            </div>
            <div class="zone-btn" onclick="enterZone(2)">
                <strong>[ìˆ™ë ¨ ì‚¬ëƒ¥í„°] Lv.11 ~ 20</strong>
                <small style="margin-top:5px; display:block;">ì…ì¥ë£Œ: ë‚´ ê²€ íŒë§¤ê°€ì˜ 40%<br>ìˆ˜ìµ: ë‚´ ê²€ íŒë§¤ê°€ ê¸°ì¤€</small>
            </div>
        </div>
        <div id="hunt-ground" style="display:none;">
            <div class="game-grid" id="hunt-grid"></div>
            <div id="hunt-log">íƒìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ ëª¬ìŠ¤í„°ë¥¼ ì°¾ìœ¼ì„¸ìš”.</div>
            
            <button id="hunt-scan-btn" onclick="scanHunt()" style="background: var(--hunt); color: white; margin-top:10px;">ğŸ“¡ ëª¬ìŠ¤í„° íƒìƒ‰</button>
            <button onclick="exitZone()" style="background:#555; color:white;">êµ¬ì—­ ë‚˜ê°€ê¸°</button>
        </div>
        <button class="btn-nav" onclick="showPage('page-main')" id="hunt-back-btn">â¬…ï¸ ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <div id="page-mine" class="page">
        <h2 style="color: var(--mine);">â›ï¸ ê´‘ì‚°</h2>
        <div id="mine-grid" class="game-grid"></div>
        <button id="mine-scan-btn" onclick="scanMine()" style="background:var(--mine); color:black; margin-top:10px;" disabled>ê´‘ì„ íƒìƒ‰ (1,000G)</button>
        <button class="btn-nav" onclick="showPage('page-main')">ëŒì•„ê°€ê¸°</button>
    </div>
</div>

<script>
    let data = { level: 0, equippedLv: -1, gold: 100000, shards: 0, inv: { item1: 0, item2: 0, item3: 0 } };
    let huntData = [], mineData = [], isAuto = false, currentZone = 0;
    
    // ë°©ì§€ê¶Œ ì„¤ì •
    const shopItems = [{name:"í•˜ê¸‰", limit:12}, {name:"ì¤‘ê¸‰", limit:15}, {name:"ìƒê¸‰", limit:99}];
    
    // ê´‘ì‚° í™•ë¥  ë°ì´í„°
    const oreTypes = [{ n: "ë¹ˆ ê³µê°„", e: "", p: 0, c: 30 }, { n: "ëŒ", e: "ğŸª¨", p: 100, c: 35 }, { n: "êµ¬ë¦¬", e: "ğŸŸ«", p: 500, c: 15 }, { n: "ì²­ë™", e: "ğŸ¥‰", p: 1000, c: 10 }, { n: "ì² ", e: "â›“ï¸", p: 2000, c: 7 }, { n: "ì€", e: "ğŸ¥ˆ", p: 10000, c: 2.4 }, { n: "ê¸ˆ", e: "ğŸ¥‡", p: 30000, c: 0.5 }, { n: "ë‹¤ì´ì•„", e: "ğŸ’", p: 100000, c: 0.1 }];

    function getUpgradeData(lv) {
        const cost = 10 * Math.pow(2, lv);
        let sp = lv === 0 ? 0 : lv <= 10 ? Math.floor(cost * 0.6) : Math.floor(cost * (2.5 + (lv - 10) * 0.5));
        const sc = lv < 3 ? 100 : lv < 6 ? 85 : lv < 9 ? 60 : lv === 9 ? 50 : 40;
        const bc = lv >= 10 ? Math.min(50, 5 + (lv - 10) * 5) : 0;
        let name = "ê²€";
        return { sc, bc, cost, sp, name };
    }

    function updateUI() {
        const d = getUpgradeData(data.level);
        document.getElementById('level').innerText = data.level;
        document.getElementById('weapon-name').innerText = d.name;
        document.getElementById('equipped-lv').innerText = data.equippedLv === -1 ? "N/A" : data.equippedLv;
        document.getElementById('gold').innerText = data.gold.toLocaleString();
        document.getElementById('shards').innerText = data.shards;
        document.getElementById('inv-1').innerText = data.inv.item1;
        document.getElementById('inv-2').innerText = data.inv.item2;
        document.getElementById('inv-3').innerText = data.inv.item3;
        document.getElementById('chance').innerText = d.sc;
        document.getElementById('break').innerText = d.bc;
        document.getElementById('cost').innerText = d.cost.toLocaleString();
        document.getElementById('sell-p').innerText = d.sp.toLocaleString();
        document.getElementById('emergency-btn').style.display = (data.gold < 1000 && data.equippedLv === -1) ? "block" : "none";
        document.getElementById('mine-scan-btn').disabled = mineData.filter(m => m && m.p > 0).length > 0;
        document.getElementById('auto-btn').innerText = isAuto ? "ìë™ ì¤‘ë‹¨" : "+10ê°• ìë™ ë„ì „";
    }

    function tryUpgrade() {
        const d = getUpgradeData(data.level);
        if(data.gold < d.cost) { isAuto = false; addLog("ê³¨ë“œ ë¶€ì¡±!"); return; }
        const sel = document.querySelector('input[name="prot"]:checked').value;
        
        if (data.level >= 15 && sel === "0") {
            if (!confirm("âš ï¸ ê²½ê³ : ë°©ì§€ê¶Œ ì—†ì´ ê³ ê°•í™”(15ê°•+)ë¥¼ ì‹œë„í•©ë‹ˆë‹¤. íŒŒê´´ ì‹œ ê²€ì´ ì†Œë©¸ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { isAuto = false; return; }
        }

        if (sel !== "0") {
            const tier = shopItems[parseInt(sel)-1];
            if (data.level >= tier.limit) { alert(`${tier.name} ë°©ì§€ê¶Œì€ ${tier.limit}ê°•ê¹Œì§€ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!`); isAuto = false; return; }
            if (data.inv[`item${sel}`] > 0) data.inv[`item${sel}`]--; else { alert("ë°©ì§€ê¶Œ ìˆ˜ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!"); isAuto = false; return; }
        }

        data.gold -= d.cost;
        if(Math.random()*100 < d.sc) {
            data.level++; addLog(`+${data.level} ì„±ê³µ!`, "#4ecca3");
            if(data.equippedLv !== -1 && data.level-1 === data.equippedLv) data.equippedLv = data.level;
        } else {
            if(Math.random()*100 < d.bc && sel !== "3") {
                if(sel === "2") data.level = Math.max(0, data.level-1); else if(sel === "1") data.level = Math.max(0, data.level-2);
                else { data.level = 0; data.shards++; data.equippedLv = -1; addLog("íŒŒê´´ë¨!", "#e94560"); isAuto = false; }
            } else { data.level = Math.max(0, data.level-1); addLog("ì‹¤íŒ¨(í•˜ë½)"); }
        }
        document.getElementById('prot-none').checked = true; save();
    }

    // [ìˆ˜ì •ëœ ë¶€ë¶„] ì‚¬ëƒ¥í„° ì…ì¥ (ë¹„ìš© ì°¨ê° X)
    function enterZone(z) {
        if(data.equippedLv === -1) { alert("ë¬´ê¸°ë¥¼ ì¥ì°©í•˜ì„¸ìš”!"); return; }
        currentZone = z;
        document.getElementById('hunt-zone-select').style.display = 'none';
        document.getElementById('hunt-ground').style.display = 'block';
        document.getElementById('hunt-back-btn').style.display = 'none';
        document.getElementById('hunt-grid').innerHTML = ""; // ì´ˆê¸°í™”
        
        // íƒìƒ‰ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        let fee = z === 1 ? 5000 : Math.floor(getUpgradeData(data.equippedLv).sp * 0.4);
        document.getElementById('hunt-scan-btn').innerText = `ğŸ“¡ ëª¬ìŠ¤í„° íƒìƒ‰ (${fee.toLocaleString()}G)`;
    }

    // [ì‹ ê·œ] ì‚¬ëƒ¥í„° íƒìƒ‰ (ë¹„ìš© ì°¨ê° O)
    function scanHunt() {
        let fee = currentZone === 1 ? 5000 : Math.floor(getUpgradeData(data.equippedLv).sp * 0.4);
        if(data.gold < fee) { alert(`ì…ì¥ë£Œ ë¶€ì¡±! (${fee.toLocaleString()}G í•„ìš”)`); return; }
        data.gold -= fee;
        
        const icons = ["ğŸ­", "ğŸ", "ğŸº", "ğŸ—", "ğŸ‘¹", "ğŸ’€", "ğŸ‰", "ğŸ‘¾"];
        const min = currentZone === 1 ? 1 : 11; 
        const max = currentZone === 1 ? 10 : 20;
        
        huntData = Array.from({length:16}, () => ({ 
            icon: icons[Math.floor(Math.random()*8)], 
            lv: Math.floor(Math.random()*(max-min+1))+min 
        }));
        renderHunt(); save();
    }

    function fight(idx) {
        const m = huntData[idx]; const diff = data.equippedLv - m.lv;
        const chance = diff >= 2 ? 100 : diff === 1 ? 75 : diff === 0 ? 50 : 50 * Math.pow(0.5, Math.abs(diff));
        
        let reward = currentZone === 1 ? getUpgradeData(m.lv).sp : getUpgradeData(data.equippedLv).sp;
        let penalty = 1; if (diff >= 10) penalty = 0; else if (diff >= 6) penalty = 0.1; else if (diff >= 3) penalty = 0.5;
        reward = Math.floor(reward * penalty);

        if(Math.random()*100 < chance) { 
            data.gold += reward; addHuntLog(`ìŠ¹ë¦¬! +${reward.toLocaleString()}G`, "#4ecca3"); 
        } else { 
            const loss = Math.floor(reward/2); const pg = data.gold; data.gold = Math.max(0, data.gold-loss); 
            addHuntLog(`íŒ¨ë°°! -${loss.toLocaleString()}G`, "#e94560");
            if(pg === 0) { data.equippedLv = -1; data.level = 0; data.shards++; exitZone(); addHuntLog("íŒŒì‚°í•˜ì—¬ ë¬´ê¸° íŒŒê´´!", "red"); }
        }
        huntData[idx] = null; renderHunt(); save();
    }

    function renderHunt() {
        const g = document.getElementById('hunt-grid'); g.innerHTML = "";
        huntData.forEach((m, i) => {
            const c = document.createElement('div'); c.className = "cell";
            if (m) {
                let diff = data.equippedLv - m.lv;
                let color = diff >= 2 ? "#2ecc71" : diff >= 0 ? "#f1c40f" : "#e94560";
                c.innerHTML = `${m.icon} <span class="monster-lv" style="color:${color}">+${m.lv}</span>`;
                c.onclick = () => fight(i);
            } g.appendChild(c);
        });
    }

    function scanMine() { 
        if(data.gold < 1000) return; data.gold -= 1000; 
        mineData = Array.from({length:16}, () => { let r = Math.random()*100, s=0; for(let o of oreTypes){s+=o.c; if(r<=s) return o;} return oreTypes[0]; });
        renderMine(); save(); 
    }
    
    // [ìˆ˜ì •] ê´‘ì‚° ê²©ì ë Œë”ë§
    function renderMine() { 
        const g = document.getElementById('mine-grid'); g.innerHTML = ""; 
        mineData.forEach((ore, i) => { 
            const c = document.createElement('div'); c.className = "cell"; 
            if(ore && ore.e) { c.innerText = ore.e; c.onclick = () => { if(!mineData[i]) return; data.gold += ore.p; mineData[i] = null; renderMine(); save(); }; } 
            g.appendChild(c); 
        }); 
    }

    function exitZone() { document.getElementById('hunt-zone-select').style.display='block'; document.getElementById('hunt-ground').style.display='none'; document.getElementById('hunt-back-btn').style.display='block'; }
    function showPage(p) { document.querySelectorAll('.page').forEach(el => el.classList.remove('active')); document.getElementById(p).classList.add('active'); if(p==='page-mine') renderMine(); }
    function save() { localStorage.setItem('swordRPG_v39', JSON.stringify(data)); updateUI(); }
    function load() { const s = localStorage.getItem('swordRPG_v39'); if(s) data = JSON.parse(s); updateUI(); }
    function addLog(m, c) { const l = document.getElementById('log'); l.innerHTML = `<div style="color:${c || '#95a5a6'}">> ${m}</div>` + l.innerHTML; }
    function addHuntLog(m, c) { document.getElementById('hunt-log').innerHTML = `<span style="color:${c}">> ${m}</span>`; }
    function startAutoUpgrade() { if(isAuto) { isAuto=false; return; } isAuto=true; const itv = setInterval(() => { if(!isAuto || data.level >= 10) { clearInterval(itv); isAuto=false; save(); return; } tryUpgrade(); }, 350); }
    function buyItem(t, p) { if(data.gold >= p) { data.gold -= p; data.inv[`item${t}`]++; save(); } }
    function exchangeShards() { if(data.shards > 0) { data.shards--; data.gold += 50000; save(); } }
    function equipWeapon() { if(data.level > 0) { data.equippedLv = data.level; save(); } }
    function sellWeapon() { const d = getUpgradeData(data.level); data.gold += d.sp; if(data.equippedLv===data.level) data.equippedLv = -1; data.level = 0; save(); }
    function getEmergencyMoney() { data.gold += 1000; save(); }

    load();
</script>
</body>
</html>
